# 🎨 生图助手 完整使用指南（完全是让ai写的，如果有问题可以问下我）

> **版本**: v44.3 | **适用平台**: SillyTavern

---

## 第一章：了解生图助手

### 1.1 它能做什么？

生图助手是一个让 AI 聊天自动配图的插件。

**没有它时**：你和AI聊天，AI只会回复文字。

**有了它后**：AI在回复时会自动添加图片描述，然后脚本调用Stable Diffusion生成对应的图片，直接显示在对话中。

### 1.2 工作原理示意

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│   第1步：你发送消息给AI                                              │
│      ↓                                                              │
│   第2步：生图助手在你的消息里"悄悄加入"生图指令                        │
│      ↓                                                              │
│   第3步：AI收到带指令的消息，回复时会写出图片描述标签                   │
│          比如：[IMG_GEN]1girl, white hair, smile[/IMG_GEN]          │
│      ↓                                                              │
│   第4步：生图助手检测到这些标签，提取出描述词                          │
│      ↓                                                              │
│   第5步：把描述词发送给Stable Diffusion生成图片                       │
│      ↓                                                              │
│   第6步：图片生成完成，显示在对话中                                   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 1.3 你需要准备什么？

在使用生图助手之前，请确保：

1. **SillyTavern 已正确安装**
2. **已配置好 Stable Diffusion API**（可以是本地 WebUI、ComfyUI，或者 NovelAI 等在线服务）
3. **已安装本脚本**

---

## 第二章：打开设置面板

### 2.1 找到入口

生图助手的入口在 SillyTavern 的**左下角**。

具体位置：找到一个**发光的蜡笔图标** ✏️，点击它会弹出扩展菜单，在菜单中找到并点击「**生图助手**」。

```
┌────────────────────────────────────────────────────────────────┐
│                                                                │
│                    SillyTavern 主界面                          │
│                                                                │
│   聊天记录显示区域...                                           │
│                                                                │
│                                                                │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌────┐                                                        │
│  │ ✏️ │ ← 点击这个发光的蜡笔图标                                │
│  └────┘                                                        │
│     │                                                          │
│     ▼                                                          │
│  ┌───────────────────────┐                                     │
│  │  扩展菜单              │                                     │
│  │  ├─ 其他扩展...        │                                     │
│  │  ├─ 其他扩展...        │                                     │
│  │  └─ 🖌️ 生图助手 ← 点这个                                    │
│  └───────────────────────┘                                     │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### 2.2 设置面板的整体布局

点击后会弹出设置面板，它的结构是这样的：

```
┌─────────────────────────────────────────────────────────────────┐
│                  生图助手 v44.0 🎨 设置面板                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌──────────┐ ┌────────────┐ ┌──────────┐ ┌──────────┐        │
│   │  主功能  │ │人物与前后缀│ │ 独立生词 │ │自定义模版│        │
│   └──────────┘ └────────────┘ └──────────┘ └──────────┘        │
│       ▲                                                         │
│       │                                                         │
│   四个标签页，点击切换                                           │
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                                                         │  │
│   │              当前标签页的设置内容                        │  │
│   │                                                         │  │
│   │                                                         │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │ [📤导出] [📥导入] [🔄恢复默认] [💾保存设置]              │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
│   底部是通用操作按钮，修改后记得点"保存设置"                     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 第三章：基础配置（让它跑起来）

这一章教你完成最基本的配置，让生图助手能够工作。

### 3.1 第一步：开启总开关

在「**主功能**」标签页中，找到「**启用解析生图**」并勾选它。

```
☑️ 启用解析生图    ← 这是总开关，必须勾选！
```

这个选项的意思是：允许脚本解析 AI 回复中的 `[IMG_GEN]...[/IMG_GEN]` 标签，并发送生图请求。

### 3.2 第二步：选择工作模式

生图助手有两种让 AI 生成图片描述的方式，你需要选择其中一种：

---

#### 方式A：注入模式（适合新手，简单）

**什么是注入模式？**

就是脚本在你发消息给AI时，自动在消息里加上一段"请在回复中添加图片描述"的指令。AI看到这个指令后，会在回复里自己写出 `[IMG_GEN]...[/IMG_GEN]` 标签。

**怎么开启？**

在「主功能」标签页勾选「**启用注入**」：

```
☑️ 启用注入    ← 勾选这个
    └─ 点击旁边的 ▾ 可以展开更多设置
       ├─ 注入深度：填0就行（表示注入到消息的末尾）
       └─ 发送角色：选System就行
```

**这种方式的优缺点**：
- ✅ 优点：配置简单，勾一下就能用
- ❌ 缺点：依赖你主API的能力，有些模型可能不太会写图片描述

---

#### 方式B：独立生图模式（适合进阶用户，更强大）

**什么是独立生图模式？**

AI 正常回复后（不包含图片标签），脚本会把 AI 的回复发给另一个 API（你单独配置的），让这个 API 分析内容并告诉脚本应该在哪里插入什么样的图片描述。

**怎么开启？**

1. 在「主功能」标签页勾选「**启用独立生图模式**」：

```
☑️ 启用独立生图模式    ← 勾选这个
    └─ 展开可设置：历史消息数（分析时参考多少条历史）
```

2. 往下滚动，找到「**独立API配置**」区域，填写API信息：

```
┌─ 独立API配置 ─────────────────────────────────────────────────┐
│                                                               │
│  Base URL:  [ https://api.deepseek.com     ]  ← 填API地址     │
│  API Key:   [ sk-xxxxxxxxxxxxxxxxxxxxxxxx ]  ← 填你的密钥     │
│  模型:      [ deepseek-chat ▼ ] [获取模型]   ← 选择模型       │
│                                                               │
│  最大Tokens: [ 8192 ]        ← 回复长度上限                   │
│  温度:       ──────●─── 0.9  ← 越高=越有创意                  │
│                                                               │
│  [🧪 测试API连接]  ← 填完后点这个测试是否能用                  │
│                                                               │
└───────────────────────────────────────────────────────────────┘
```

**这种方式的优缺点**：
- ✅ 优点：不影响主API，可以用更便宜的模型专门分析生图
- ✅ 优点：效果更可控，可以自定义分析模版
- ❌ 缺点：需要额外配置API

---

### 3.3 第三步：设置人物特征

这一步非常重要！你需要告诉脚本你角色卡里有哪些人物，以及他们长什么样。

切换到「**人物与前后缀**」标签页：

```
┌─ 人物列表 ─────────────────────────────────────────────────────┐
│                                                                │
│  勾选 │  人物名称  │  固定外貌特征标签                 │ 操作  │
│  ─────┼───────────┼──────────────────────────────────┼─────── │
│   ☑️  │   小雪    │ 1girl, long white hair, blue     │ [删除] │
│       │           │ eyes, petite, pale skin          │        │
│  ─────┼───────────┼──────────────────────────────────┼─────── │
│   ☑️  │   主角    │ 1boy, short black hair, brown    │ [删除] │
│       │           │ eyes, tall, athletic             │        │
│  ─────┼───────────┼──────────────────────────────────┼─────── │
│                                                                │
│  [+] ← 点击添加新人物                                          │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

**怎么填写人物特征？**

1. **人物名称**：填写这个人物在角色卡/对话中使用的名字
2. **固定外貌特征**：用英文逗号分隔的 Stable Diffusion 标签，描述这个人物不变的外貌特征

**示例**：

| 人物名 | 固定特征 |
|-------|----------|
| 小雪 | `1girl, long white hair, blue eyes, petite, pale skin, small breasts` |
| 艾琳 | `1girl, short red hair, green eyes, freckles, medium breasts` |
| 主角 | `1boy, short black hair, brown eyes, average build` |

**注意事项**：
- 只写"不变"的特征（如发色、瞳色），不要写表情、动作、衣服（这些由AI根据剧情生成）
- 勾选框勾上表示启用这个人物，取消勾选表示暂时禁用

### 3.4 第四步：保存设置

完成上面的配置后，一定要点击面板底部的「**💾 保存设置**」按钮！

不保存的话，关闭面板后所有设置都会丢失。

---

## 第四章：开始使用

### 4.1 正常对话

配置完成后，正常和 AI 对话即可。

如果一切正常，AI 的回复中会出现类似这样的内容：

```
小雪微笑着向你走来。
[IMG_GEN]1girl, long white hair, blue eyes, smile, walking, school uniform, 
classroom, sunlight, masterpiece, best quality[/IMG_GEN]
"早上好！"她轻声说道。
```

脚本检测到 `[IMG_GEN]...[/IMG_GEN]` 后，会自动提取里面的内容，发送给 SD 生成图片。

### 4.2 图片显示与交互

图片生成后会以下面的界面形式显示在对话中：

```
                         ▵ 
            （点击这个小三角可以折叠/展开图片）
                         
┌───────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────────┐  │
│  │              顶部区域（占20%高度）                       │  │
│  │              点击这里可以编辑提示词                      │  │
│  └─────────────────────────────────────────────────────────┘  │
│                                                               │
│  ┌──────────┬─────────────────────────┬──────────┐           │
│  │          │                         │          │           │
│  │  左侧    │                         │  右侧    │           │
│  │  区域    │                         │  区域    │           │
│  │          │      显示的图片          │          │           │
│  │ (占20%)  │                         │ (占20%)  │           │
│  │          │                         │          │           │
│  │ 点击看   │                         │ 点击看   │           │
│  │ 上一张   │                         │ 下一张   │           │
│  │          │                         │ 或重新   │           │
│  │          │                         │ 生成     │           │
│  └──────────┴─────────────────────────┴──────────┘           │
│                                                               │
│  左下角：点击删除当前图片              [1/3] 表示当前是第1张   │
│                                              共3张图          │
└───────────────────────────────────────────────────────────────┘
```

**各区域功能总结**：

| 区域位置 | 点击后的效果 |
|---------|-------------|
| 顶部 20% | 打开编辑弹窗，可以手动修改提示词，或者让AI帮你优化 |
| 左侧 20% | 如果生成了多张图，点击切换到上一张 |
| 右侧 20% | 如果有下一张就切到下一张；如果已经是最后一张，就重新生成 |
| 左下角 5% | 删除当前正在显示的这张图 |
| 顶部 ▵ | 把图片区域折叠起来，或者展开 |

### 4.3 编辑提示词

点击图片的顶部区域后，会弹出编辑窗口：

```
┌─ 编辑提示词 (Block 1) ───────────────────────────────────────────┐
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │ 1girl, long white hair, blue eyes, smile, standing,       │ │
│  │ school uniform, classroom, sunlight, masterpiece           │ │
│  │                                                            │ │
│  │  ← 这里显示当前的提示词，你可以直接修改                     │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  AI修改指令输入框（点击下方「AI优化」按钮展开）           │    │
│  │  [ 把背景改成夜晚的月光下 ]                              │    │
│  │  [🚀 执行AI更新]                                         │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌──────────────┬──────────────┬──────────────┐                 │
│  │   🪄 AI优化   │   ✏️ 仅修改   │   🎨 生成    │                 │
│  └──────────────┴──────────────┴──────────────┘                 │
│                                                                  │
│  🪄 AI优化：展开AI修改指令框，输入修改要求后让AI帮你改           │
│  ✏️ 仅修改：只保存你的修改，不生成图（之后手动点右侧区域生成）    │
│  🎨 生成：保存修改并立即生成图片                                 │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

---

## 第五章：进阶设置详解

### 5.1 「主功能」标签页详细说明

```
┌─ 主功能 ──────────────────────────────────────────────────────────┐
│                                                                   │
│  ☑️ 启用解析生图                                                  │
│     │                                                             │
│     └─ 展开后的子设置：                                           │
│        ├─ 多图生成间隔: [1] 秒                                    │
│        │     一条消息里有多张图时，每张之间等多久再生成下一张       │
│        │                                                          │
│        ├─ 重试次数: [3] 次  重试间隔: [1] 秒                      │
│        │     生成失败后重试几次，每次间隔多久                       │
│        │                                                          │
│        ├─ ☑️ 自动发送生图请求                                     │
│        │     勾选：检测到标签后自动生图                            │
│        │     不勾选：检测到后显示占位符，需要你手动点击右侧来生成    │
│        │                                                          │
│        └─ ☐ 启用请求超时 [120] 秒                                 │
│              勾选后，如果生图请求超过指定秒数没响应，自动取消重试    │
│              防止一直卡在"请求中"                                  │
│                                                                   │
│  ─────────────────────────────────────────────────────────────── │
│                                                                   │
│  ☐ 启用注入                                                      │
│     │  （勾选表示使用「注入模式」）                                │
│     └─ 展开后：                                                   │
│        ├─ 注入深度：一般填0                                       │
│        └─ 发送角色：一般选System                                  │
│                                                                   │
│  ☐ 启用独立生图模式                                               │
│     │  （勾选表示使用「独立API模式」）                             │
│     └─ 展开后：                                                   │
│        ├─ 历史消息数：分析时参考最近几条对话                       │
│        └─ 防抖延迟：AI回复后等多久再分析（防止频繁触发）           │
│                                                                   │
│  ☐ 顺序生图（NAI请开）                                            │
│     勾选后，同一条消息的多张图会一张一张生成，前一张完成再生下一张  │
│     如果你用NovelAI或其他有并发限制的服务，请务必勾选              │
│                                                                   │
│  ☐ 流式生图                                                       │
│     勾选后，AI还没打完字时，脚本就开始检测并生图                   │
│     不用等AI完全回复完                                            │
│                                                                   │
│  ─────────────────────────────────────────────────────────────── │
│                                                                   │
│  独立API配置（只有使用「独立生图模式」时需要配置）                  │
│  ...详见第三章的说明...                                           │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

### 5.2 「人物与前后缀」标签页详细说明

除了人物列表（第三章已讲），这个页面还有三个文本框：

```
┌─ 人物与前后缀 ────────────────────────────────────────────────────┐
│                                                                   │
│  人物列表... (见第三章)                                           │
│                                                                   │
│  ─────────────────────────────────────────────────────────────── │
│                                                                   │
│  全局前缀：                                                       │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ masterpiece, best quality, highly detailed                 │ │
│  └─────────────────────────────────────────────────────────────┘ │
│  这里填的内容会加到每个提示词的【开头】                            │
│  一般填质量词，保证每张图都有基础质量                              │
│                                                                   │
│  全局后缀：                                                       │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ 8k wallpaper, intricate details                            │ │
│  └─────────────────────────────────────────────────────────────┘ │
│  这里填的内容会加到每个提示词的【结尾】                            │
│                                                                   │
│  负面提示词：                                                     │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ lowres, bad anatomy, bad hands, text, error, missing       │ │
│  │ fingers, extra digit, fewer digits, cropped, worst         │ │
│  │ quality, low quality, normal quality, jpeg artifacts       │ │
│  └─────────────────────────────────────────────────────────────┘ │
│  这里填的是SD的负面提示词（negative prompt）                       │
│  告诉SD不要画什么                                                 │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

### 5.3 「独立生词」标签页详细说明

这个标签页专门为「独立生图模式」提供高级配置。如果你只使用「注入模式」，可以跳过这一节。

```
┌─ 独立生词 ────────────────────────────────────────────────────────┐
│                                                                   │
│  🔍 过滤标签（上下文过滤）                                         │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ <small>, [statbar], <div>                                  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│  有些角色卡会在消息里加一些HTML标签或特殊格式（比如状态栏），        │
│  这些内容不应该被分析，在这里填上可以让脚本忽略它们                  │
│                                                                   │
│  支持三种格式，用英文逗号分隔：                                    │
│  • <xxx>  会过滤 <xxx>任意内容</xxx>                              │
│  • [xxx]  会过滤 [xxx]任意内容[/xxx]                              │
│  • 前缀|后缀  会过滤 前缀任意内容后缀                              │
│                                                                   │
│  ─────────────────────────────────────────────────────────────── │
│                                                                   │
│  📚 世界书注入                                                    │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ [🔄 加载角色世界书]                                         │ │
│  │                                                             │ │
│  │ 加载后会显示角色关联的世界书条目列表：                        │ │
│  │                                                             │ │
│  │  ☑️ 【主世界书】角色设定条目                                 │ │
│  │     ☑️ 外貌描述                                              │ │
│  │     ☑️ 性格特点                                              │ │
│  │     ☐ 背景故事                                               │ │
│  │                                                             │ │
│  │ [全选] [全不选] [💾 保存选择]                                │ │
│  └─────────────────────────────────────────────────────────────┘ │
│  勾选的世界书条目会作为参考资料发给独立API                         │
│  帮助它更好地理解人物设定                                         │
│                                                                   │
│  ─────────────────────────────────────────────────────────────── │
│                                                                   │
│  🔍 预览与调试                                                    │
│  [🔄 刷新预览]  ← 点击后可以看到实际发给API的完整内容              │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ 显示：最新楼层内容（带编号）和历史上下文                      │ │
│  │ 还有完整的提示词结构                                        │ │
│  │ 用于调试，确认发送的内容是否正确                             │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

### 5.4 「自定义模版」标签页详细说明

这个标签页包含3个子标签页，用于自定义各种模版。

#### 5.4.1 提示词模版

这个模版决定了AI在生成图片描述时遵循的规则。

```
┌─ 提示词模版 ──────────────────────────────────────────────────────┐
│                                                                   │
│  📝 提示词模版: [默认模版 ▼]  [🗑️]                               │
│                                                                   │
│  下拉框选择模版，旁边的删除按钮可以删除自定义模版                   │
│  系统自带的默认模版不能删除                                       │
│                                                                   │
│  模版名称: [                    ]  [💾 保存]                      │
│  留空=覆盖当前模版，填新名字=另存为新模版                          │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ <IMAGE_PROMPT_TEMPLATE>                                    │ │
│  │ You are a Visual Novel Engine...                           │ │
│  │                                                            │ │
│  │ ## 人物数据库                                              │ │
│  │ <!--人物列表-->                                            │ │
│  │         ↑                                                  │ │
│  │     这个占位符会被替换成你设置的人物特征列表                 │ │
│  │                                                            │ │
│  │ ## 核心规则                                                │ │
│  │ 1. 每200-250字插入一个图片...                              │ │
│  │ </IMAGE_PROMPT_TEMPLATE>                                   │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                   │
│  💡 模版中的 <!--人物列表--> 会自动替换为启用的人物及其特征        │
│                                                                   │
│  [🤖 使用AI修改模版]  ← 让AI帮你修改模版内容                       │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

#### 5.4.2 独立生词模版 / AI修改模版

这两个模版的编辑界面是类似的，都是多条消息组成的对话结构：

```
┌─ 独立生词模版（或AI修改模版）─────────────────────────────────────┐
│                                                                   │
│  ┌──────┬───────────────────────────────────────────────────────┐│
│  │      │                                                       ││
│  │ [01] │  标签: [身份定义    ]   角色: [system ▼]              ││
│  │      │                                                       ││
│  │ [02] │  [⬆️上移] [⬇️下移] [🗑️删除]                          ││
│  │      │                                                       ││
│  │ [03] │  ┌─────────────────────────────────────────────────┐  ││
│  │      │  │ You are an advanced Stable Diffusion prompt    │  ││
│  │ [04] │  │ generator...                                   │  ││
│  │      │  │                                                │  ││
│  │ [05] │  │ 这里编辑消息的具体内容                         │  ││
│  │      │  │                                                │  ││
│  │ ...  │  │ 可以使用占位符，比如：                          │  ││
│  │      │  │ <!--历史上下文-->                              │  ││
│  │ [+]  │  │ <!--世界书-->                                  │  ││
│  │      │  │ <!--生词模版-->                                │  ││
│  │      │  │ <!--当前楼层-->                                │  ││
│  │      │  └─────────────────────────────────────────────────┘  ││
│  └──────┴───────────────────────────────────────────────────────┘│
│                                                                   │
│  左侧是消息序号列表：                                              │
│  • 点击某个数字可以切换编辑那条消息                                │
│  • 点击[+]添加新消息                                              │
│                                                                   │
│  右侧是编辑区：                                                    │
│  • 标签：给这条消息起个名字（方便识别，不影响实际内容）              │
│  • 角色：system / user / assistant，定义这条消息的发送者角色       │
│  • 内容区：实际发送给API的内容                                     │
│                                                                   │
│  ─────────────────────────────────────────────────────────────── │
│                                                                   │
│  💡 可用占位符（会被实际内容替换）：                               │
│                                                                   │
│  独立生词模版专用：                                               │
│  <!--历史上下文--> → 替换为最近几条对话记录                        │
│  <!--世界书-->     → 替换为勾选的世界书内容                        │
│  <!--生词模版-->   → 替换为当前使用的提示词模版                    │
│  <!--当前楼层-->   → 替换为最新的AI回复（带段落编号）              │
│                                                                   │
│  AI修改模版专用：                                                 │
│  <!--提示词-->    → 替换为当前正在编辑的提示词                     │
│  <!--修改要求-->  → 替换为你输入的修改指令                         │
│                                                                   │
│  ─────────────────────────────────────────────────────────────── │
│                                                                   │
│  [🔄 恢复默认模版]  ← 重置为系统默认，你的修改会丢失               │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

---

## 第六章：配置管理

### 6.1 导出配置

点击「**📤 导出配置**」可以把当前所有设置保存为一个 JSON 文件。

用途：
- 备份你的配置
- 分享配置给别人
- 换电脑时迁移配置

### 6.2 导入配置

点击「**📥 导入配置**」选择之前导出的 JSON 文件，可以恢复所有设置。

### 6.3 恢复默认

点击「**🔄 恢复默认**」会把所有设置重置为初始状态。

⚠️ 这个操作不可撤销，请先导出配置做备份！

### 6.4 API预设

在「独立API配置」区域，你可以保存多套API配置：

```
📦 API预设: [默认配置 ▼] [💾 保存] [🗑️ 删除]
[输入新预设名称（留空则覆盖当前预设）]
```

- **加载预设**：下拉选择，配置会自动填充到下面的输入框
- **覆盖保存**：不填名称，直接点保存
- **另存新预设**：输入新名称，点保存
- **删除预设**：选中后点删除

---

## 第七章：常见问题解答

### Q1：图片没有生成，是空白或者一直显示"等待生成"？

**检查清单**：

1. ✅「启用解析生图」是否勾选？
2. ✅ 酒馆的 SD API 是否正确配置？（在酒馆自带的SD设置里测试一下）
3. ✅ AI 的回复里是否真的包含 `[IMG_GEN]...[/IMG_GEN]` 标签？
4. ✅ 如果用独立模式，API是否配置正确？（点「测试API连接」）

### Q2：AI不生成图片标签，回复里没有 [IMG_GEN]？

**注入模式**：可能是你的主API模型不太会按指令写标签。尝试：
- 换一个能力更强的模型
- 或者改用「独立生图模式」

**独立模式**：检查独立API配置是否正确。

### Q3：生成的图片人物特征不对？

检查「人物与前后缀」标签页：
- 人物名称是否和对话中使用的一致？
- 固定特征是否填写正确？
- 勾选框是否勾上？

### Q4：使用NovelAI总是报错？

勾选「**顺序生图**」选项。

NovelAI不允许同时发送多个请求，开启顺序生图后会一张一张生成。

### Q5：图片生成时间太长，一直卡在"请求中"？

启用「**请求超时**」功能，设置一个合理的秒数（如60-120秒）。

超时后会自动取消并重试。

### Q6：我想手动控制什么时候生图，不想自动生成？

取消勾选「**自动发送生图请求**」。

这样检测到标签后只会显示占位符，你需要点击图片区域的右侧来手动触发生成。

---

## 附录：占位符速查表

| 占位符 | 用在哪个模版 | 会被替换成 |
|-------|-------------|-----------|
| `<!--人物列表-->` | 提示词模版 | 你设置的人物名称和固定特征 |
| `<!--历史上下文-->` | 独立生词模版 | 最近的对话记录 |
| `<!--世界书-->` | 独立生词模版 | 勾选的世界书条目内容 |
| `<!--生词模版-->` | 独立生词模版 | 当前使用的提示词模版 |
| `<!--当前楼层-->` | 独立生词模版 | 最新的AI回复（带段落编号） |
| `<!--提示词-->` | AI修改模版 | 当前正在编辑的图片提示词 |
| `<!--修改要求-->` | AI修改模版 | 你输入的修改指令 |

---

## 附录：图片标签格式

AI生成的图片描述应该用这个格式包裹：

```
[IMG_GEN]1girl, long white hair, blue eyes, smile, standing, school uniform[/IMG_GEN]
```

- 开头是 `[IMG_GEN]`
- 结尾是 `[/IMG_GEN]`
- 中间是逗号分隔的 Stable Diffusion 标签

---

> 💡 **重要提醒**：每次修改设置后，一定要点击「💾 保存设置」！
